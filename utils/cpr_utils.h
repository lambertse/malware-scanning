#ifndef __cpr_utils_h__
#define __cpr_utils_h__

#include "ms_json.h"
#include "ms_dict.h"
#include "ms_defines.h"
#include "ms_return_codes.h"
#include <cpr/cpr.h>

enum CallOrigin {
  hash,
  sendFile,
  sendFileLocal,
  checkDataId,
  isSanitizationAvailable,
  getFileSanitization,
  writeSanitizationFile,
  initializeGroupTransfer,
  initializeFileTransfer,
  uploadFileToVault,
  completeFileTransfer,
  completeGroupTransfer,
  getServerConnectionStatus,
  createGuestAccountForVault,
  getSanitizationFilename,
  getApiVersion,
  checkApiKey,
  checkApiKeyLimits,
  fetchRule
};

class BaseCprUtils {
public:
	ms_bool ShouldRetry(const cpr::Response& response, uint32_t& iteration, const int& timeToCancelRetry = -1);
	MSDict ShouldReportError(const cpr::Response& response);
	std::pair<bool, MSDict> ShouldReportParseError(CallOrigin, std::string in);
	static MSDict CreateErrorDict(int httpCode, int curlErrorCode, std::wstring errMsg);

  BaseCprUtils(){};
  ~BaseCprUtils(){};

protected:
  virtual MSDict ShouldReportSpecificError(const cpr::Response& response);
  virtual ms_bool ShouldRetrySpecific(){return true;}
};

inline std::string CallOriginStr(CallOrigin origin) {
  switch (origin) {
    case CallOrigin::hash:
      return "check-hash";
    case CallOrigin::sendFile:
      return "network-upload-file";
    case CallOrigin::sendFileLocal:
      return "local-upload-file";
    case CallOrigin::checkDataId:
      return "query-dataid";
    case CallOrigin::isSanitizationAvailable:
      return "isSanitizationAvailable";
    case CallOrigin::getFileSanitization:
      return "getFileSanitization";
    case CallOrigin::writeSanitizationFile:
      return "writeSanitizationFile";
    case CallOrigin::initializeGroupTransfer:
      return "initializeGroupTransfer";
    case CallOrigin::initializeFileTransfer:
      return "initializeFileTransfer";
    case CallOrigin::uploadFileToVault:
      return "uploadFileToVault";
    case CallOrigin::completeFileTransfer:
      return "completeFileTransfer";
    case CallOrigin::completeGroupTransfer:
      return "completeGroupTransfer";
    case CallOrigin::getServerConnectionStatus:
      return "getServerConnectionStatus";
    case CallOrigin::createGuestAccountForVault:
      return "createGuestAccountForVault";
    case CallOrigin::getSanitizationFilename:
      return "getSanitizationFilename";
    case CallOrigin::getApiVersion:
      return "getApiVersion";
    case CallOrigin::checkApiKey:
      return "checkApiKey";
    case CallOrigin::checkApiKeyLimits:
      return "checkApiKeyLimits";
    default:
      return "unknown";
  }
}

#endif