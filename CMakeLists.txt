# Device Scanning module
cmake_minimum_required( VERSION 3.5.0 )
project( malwarescan )
if ( MSVC )
    add_definitions( -DMSCUS_EXPORT -DUNICODE )
endif()

#linux
include_directories(${CMAKE_SOURCE_DIR}/agent/core/axzutils )
include_directories(${CMAKE_SOURCE_DIR}/common )
include_directories( ${CMAKE_SOURCE_DIR}/shared/axzscu )
include_directories( ${CMAKE_SOURCE_DIR}/shared/axzdict )

#both
include_directories( ${CMAKE_SOURCE_DIR}/cross-platform/3rd-party/cpr/include)
include_directories( ${CMAKE_SOURCE_DIR}/cross-platform/3rd-party/spdlog/include)
include_directories( ${CMAKE_SOURCE_DIR}/cross-platform/3rd-party/SQLiteCpp/include)
include_directories( ${CMAKE_SOURCE_DIR}/cross-platform/3rd-party/msdict)
include_directories( ${CMAKE_CURRENT_LIST_DIR}/)


set( CMAKE_SKIP_BUILD_RPATH FALSE )
set( CMAKE_BUILD_WITH_INSTALL_RPATH TRUE )
set( CMAKE_INSTALL_RPATH "$ORIGIN" )

# for headers included
set( MS_MAF_DIR ${CMAKE_SOURCE_DIR}/3rdparty/maf/include)
set( MS_DICT_DIR ${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/msdict)
set( MS_PATH_FINDER_DIR ${CMAKE_CURRENT_SOURCE_DIR}/path_finder)
include_directories(
    ${MS_MAF_DIR}
    ${MS_DICT_DIR}
    ${MS_PATH_FINDER_DIR}
)

# for dependent library linked
link_directories (${CMAKE_ARCHIVE_OUTPUT_DIRECTORY} )
link_directories (${CMAKE_LIBRARY_OUTPUT_DIRECTORY} )
# for module sources
file( GLOB LIB_SCN_SOURCES 
    *.cpp 
    path_finder/*.cpp 
    path_finder/linux/*.cpp 
    3rdparty/*/*.cpp
    utils/*/*.cpp
    utils/*.cpp)

# do generate shared library
add_library( ${PROJECT_NAME} SHARED ${LIB_SCN_SOURCES} )

# do link dependent libraries
set( MS_LINKED_LIBS 
    maf 
    cpr::cpr
    spdlog 
)

#link for linux
target_link_libraries( ${PROJECT_NAME} axzscu axzdct axzutls)

target_link_libraries( ${PROJECT_NAME} stdc++fs ${MS_LINKED_LIBS} )
target_link_libraries( ${PROJECT_NAME}
  SQLiteCpp
  sqlite3
  pthread
  dl
  )
        
include_directories( ${CMAKE_SOURCE_DIR}/3rdparty/curl/include)
include_directories( ${CMAKE_SOURCE_DIR}/3rdparty/openssl/include )
target_link_libraries(${PROJECT_NAME} ${CMAKE_SOURCE_DIR}/3rdparty/curl/lib/x64/libcurl.so )
target_link_libraries(${PROJECT_NAME} ${CMAKE_SOURCE_DIR}/3rdparty/openssl/lib/x64/libcrypto.so )
target_link_libraries(${PROJECT_NAME} ${CMAKE_SOURCE_DIR}/3rdparty/openssl/lib/x64/libssl.so )

    
# for version
set_target_properties( ${PROJECT_NAME} PROPERTIES VERSION ${AXZ_AGENT_VERSION_STRING} )