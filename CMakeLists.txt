# Device Scanning module
cmake_minimum_required( VERSION 3.5.0 )

project( malwarescan )

if ( MSVC )
    add_definitions( -DAXZCUS_EXPORT -DUNICODE )
endif()

#linux
include_directories(${CMAKE_SOURCE_DIR}/agent/core/axzutils )
include_directories(${CMAKE_SOURCE_DIR}/common )

set( CMAKE_SKIP_BUILD_RPATH FALSE )
set( CMAKE_BUILD_WITH_INSTALL_RPATH TRUE )
set( CMAKE_INSTALL_RPATH "$ORIGIN" )

# for headers included
set( AXZ_MAF_DIR ${CMAKE_SOURCE_DIR}/3rdparty/maf/include)
set( AXZ_DICT_DIR ${CMAKE_CURRENT_SOURCE_DIR}/shared/axzdict)
set( AXZ_PATH_FINDER_DIR ${CMAKE_CURRENT_SOURCE_DIR}/path_finder)

include_directories(
    ${AXZ_MAF_DIR}
    ${AXZ_DICT_DIR}
    ${AXZ_PATH_FINDER_DIR}
)

# for dependent library linked
link_directories (${CMAKE_ARCHIVE_OUTPUT_DIRECTORY} )
link_directories (${CMAKE_LIBRARY_OUTPUT_DIRECTORY} )
# for module sources
file( GLOB LIB_SCN_SOURCES 
    *.cpp 
    path_finder/*.cpp 
    path_finder/linux/*.cpp 
    shared/*/*.cpp)

# do generate shared library
add_library( ${PROJECT_NAME} SHARED ${LIB_SCN_SOURCES} )

# do link dependent libraries
set( AXZ_LINKED_LIBS maf)
target_link_libraries( ${PROJECT_NAME} ${AXZ_LINKED_LIBS} stdc++fs)

set( 3RD_CURL_DIR ${CMAKE_SOURCE_DIR}/3rdparty/curl/include )      
# set( 3RD_LIBSSL_DIR ${CMAKE_SOURCE_DIR}/3rdparty/openssl/include )
# include_directories( ${3RD_LIBSSL_DIR} )  
 
include_directories( ${3RD_CURL_DIR} )
target_link_libraries(${PROJECT_NAME} ${CMAKE_SOURCE_DIR}/3rdparty/curl/lib/x64/libcurl.so )
target_link_libraries(${PROJECT_NAME} ${CMAKE_SOURCE_DIR}/3rdparty/openssl/lib/x64/libcrypto.so )
target_link_libraries(${PROJECT_NAME} ${CMAKE_SOURCE_DIR}/3rdparty/openssl/lib/x64/libssl.so )

    
# for version
set_target_properties( ${PROJECT_NAME} PROPERTIES VERSION ${AXZ_AGENT_VERSION_STRING} )