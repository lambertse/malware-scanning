#ifndef __ms_task_h__
#define __ms_task_h__

#include "ms_layers.h"
#include "3rdparty/msdict/ms_dict.h"

enum Status{
    VERIFY,
    MANIFEST,
    CDR,
    CALCULATE_HASH,
    CHECK_LOCAL_HASH,
    CHECK_SERVER_HASH, 
    UPLOADING,
    QUERY_RESULT,
};
class MalwareScanTask;
using ms_shared_scan_task = std::shared_ptr<MalwareScanTask>;
using ms_task_done_callback = std::function<void()>;

class MalwareScanTask : public MalwareScanLayer {
public:
    MalwareScanTask(std::shared_ptr<MalwareScanLayer> srcSteps = nullptr, const MSDict& srcParam = nullptr) 
        : MalwareScanLayer(), 
        _layers(srcSteps),
        _param(srcParam)
    {
    }
    ms_rc start(const MSDict& in_dict, MSDict& out_dict) override;

private:
    struct FileScanInfo{
        std::wstring fileName;
        std::ifstream& streams;
        size_t size;
    };
    std::shared_ptr<FileScanInfo> _fileInfo;
    ms_shared_layer_ptr _layers;
    ms_task_done_callback _callback;
    MSDict _param;

};
#endif