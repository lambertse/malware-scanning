#ifndef __ms_localdb_manager_h__
#define __ms_localdb_manager_h__

#include "3rdparty/SQLiteCpp/include/SQLiteCpp/SQLiteCpp.h"
#include "ms_return_codes.h"
#include <thread>
#include <mutex>


struct FileInfo
{
    std::string hash;
    std::string scanResults;
    int ttl = 0;
};

static const std::string TABLE_NAME = "SCANRESULTS";
static const std::string HASH_COLUMN_NAME = "HASH";
static const std::string RESULT_COLUMN_NAME = "RESULTS";
static const std::string TTL_COLUMN_NAME = "TTL";

class LocalDatabaseManager
{
public:
    static LocalDatabaseManager* instance();
    LocalDatabaseManager( const LocalDatabaseManager& ) = delete;
    LocalDatabaseManager( LocalDatabaseManager&& ) = delete;
    LocalDatabaseManager& operator=( const LocalDatabaseManager& ) = delete;
    LocalDatabaseManager& operator=( LocalDatabaseManager&& ) = delete;

    ms_rc queryLocalHash(const std::wstring& srcHash, std::wstring& result);
    ms_rc saveLocalHash(const std::wstring& srcHash, const std::wstring& srcResult, int srcTtl);

private:
    LocalDatabaseManager();
    
    ~LocalDatabaseManager();
    
	std::mutex _queryMtx;
	std::mutex _savingMtx;
    static LocalDatabaseManager* m_instance;
};


#endif