
#ifndef __ms_engine_h__
#define __ms_engine_h__

#include "3rdparty/msdict/ms_dict.h"
#include "ms_return_codes.h"
#include "ms_layers_abstract.h"
#include "ms_export.h"
// #include "path_finder/FinderFactory.h"
// #include "path_finder/PathFinder.h"

#include <chrono>
#include <unordered_set>
#include <memory>

#ifdef _MSC_VER
#	pragma warning( push )
#	pragma warning( disable: 4251 )
#endif

enum ScanType
{
    Memory = 0,
    SystemVolumes = 1,
    PortableVolumes = 2,
    LocalAditionalVolumes = 3,
    SpecificPath = 4,
    BootRecords = 5,
    Invalid
};

class FileScanResult
{
public:
    FileScanResult(){
        infectedList.become(MSDictType::ARRAY);
        vulnerableList.become(MSDictType::ARRAY);
        ignoredList.become(MSDictType::ARRAY);
    }

    MSDict infectedList;
    MSDict vulnerableList;
    MSDict ignoredList;
};


class MS_DECLSPEC MalwareScanEngine
{
public:
    MalwareScanEngine();
    ~MalwareScanEngine();

    ms_rc init();
    ms_rc stop(){}
    ms_rc cancel(){}
    ms_rc pause(){}
    ms_rc resume(){}
    ms_rc start();

    ms_wstring getScanResultData();

private:
    ms_shared_layer_ptr                             _layers;
    FileScanResult                                  _filesResult;
    std::time_t                                     _start_time;
    std::unordered_set<ms_wstring>                  _files;
    MSDict                                          _scanConfig;
    MSDict                                          _reqHeader;
    MSDict                                          _scanResult;
    // std::vector<PathFinder*>                        _finders;
};



#endif
