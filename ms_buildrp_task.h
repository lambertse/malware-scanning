#ifndef __ms_buildrp_task_h__
#define __ms_buildrp_task_h__

#include "ms_layers_abstract.h"
#include <maf/utils/Observable.h>
#include <mutex>
#include <atomic>

using namespace maf::signal_slots;

class MalwareScanBuildRP{
public:
    MalwareScanBuildRP();
    ~MalwareScanBuildRP();

    ms_rc start(const MSDict& in_dict, MSDict& out_dict);
    
    MSDict onNewFileScanned( MSDict file_result);
    MSDict onScanFinished();
    ms_rc  onNewBlockResult( MSDict file_result);

    ms_rc  filterIgnoredResults();    
    ms_rc buildAndSendScanReport();
    ms_rc createSOTReport(MSDict& sotReportData);

    static MSDict getSummaryData();

public:
    ms_wstring explainationMsg;
    Observable<double> completePercentage;
    time_t startTime = std::time(nullptr);
    time_t endTime; 
    int totalScannedFile = 0;
    int totalAllowedFile = 0;
    int totalSkippedByHash = 0;
    int processedDataSize = 0;

private:
    std::mutex _mtx;

    std::atomic_int _totalBlockFile = 0; 
    MSDict _param;
    MSDict _pScanConfig;
    ms_dict_object _blockedResults;
    ms_dict_object _vulnarableResults;
    ms_dict_object _skippedResults;
    ms_dict_object _ignoredResults;
    std::set<std::string> _errorMsgs;
}; 

#endif