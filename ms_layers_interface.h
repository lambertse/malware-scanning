#ifndef __ms_layers_interface_h__
#define __ms_layers_interface_h__

#include "shared/axzdict/axz_dict.h"

#include <memory>
#include <iostream>
#include <thread>
#include <condition_variable>

using ms_ll =  unsigned long long;

class MalwareScanLayer;
using ms_shared_layer_ptr = std::shared_ptr<MalwareScanLayer>;

class MalwareScanLayer
{
public:
    MalwareScanLayer() : _nextStep(nullptr){}
    virtual ms_rc start(const AxzDict& in_dict, AxzDict& out_dict)
    {
        return this->_nextStep ? this->_nextStep->start(in_dict, out_dict) : MS_OK;
    }
    ms_shared_layer_ptr setNext(ms_shared_layer_ptr srcNext)
    {
        _nextStep = srcNext;
        return _nextStep;
    }

protected:
    ms_shared_layer_ptr _nextStep;

};

class Slot{
public:
    Slot(ms_ll srcLimitSize) : _limitTotalSize(srcLimitSize) {}
    ~Slot(){}

    void waitUntilSlotAvailable(){}
private:
    std::mutex _slotMtx;
    std::condition_variable _slotCv;

    ms_ll _limitTotalSize;
    ms_ll _currentProcessingSize;
};


#endif