#ifndef __ms_threadpool_h__
#define __ms_threadpool_h__

#include "ms_scan_task.h"
#include <string>
#include <vector>
#include <atomic>
#include <thread>
#include <mutex>
#include <maf/threading/Queue.h>
#include <unordered_map>


class ThreadPoolInterface;
using ms_shared_pool = std::shared_ptr<ThreadPoolInterface>;

class  ThreadPoolInterface : public std::enable_shared_from_this<ThreadPoolInterface> {

private:
    bool done;
    std::atomic_int _taskDone;   
    std::vector<std::thread> threads;
    
    maf::threading::Queue<ms_shared_layer_ptr> _workQueue;

    std::mutex _mtx;
    std::condition_variable _cv;

public:
    ThreadPoolInterface(unsigned threadCount);
    virtual ~ThreadPoolInterface();

    ThreadPoolInterface(const ThreadPoolInterface&) = default;
    ThreadPoolInterface& operator=(const ThreadPoolInterface&) = default;

    ThreadPoolInterface(ThreadPoolInterface&&) = default;
    ThreadPoolInterface& operator=(ThreadPoolInterface&&) = default;

    void work();
    void stop();
    bool empty();
    void push(ms_shared_layer_ptr task);

    std::unordered_map<std::thread::id, int> threatMap;
};

#endif
