
#ifndef __ms_engine_h__
#define __ms_engine_h__

#include "msdict/ms_dict.h"
#include "ms_return_codes.h"
#include "ms_layers_abstract.h"
#include "ms_export.h"
#include "ms_buildrp_listener.h"
#include "path_finder/PathFinder.h"

#include <chrono>
#include <unordered_set>
#include <memory>

#ifdef _MSC_VER
#	pragma warning( push )
#	pragma warning( disable: 4251 )
#endif



class MalwareScanEngine
{
public:
    MalwareScanEngine(ms_int srcEvent, std::shared_ptr<std::promise<ms_bool>> srcPromise, ms_wstring srcScanOption = L"");
    ~MalwareScanEngine();

    ms_rc init();
    ms_rc deinit();
    ms_rc stop(){}
    ms_rc cancel(){}
    ms_rc pause(){}
    ms_rc resume(){}
    ms_rc start();

    ms_wstring getScanResult();
    ms_int getActionResult();
    ms_wstring getExplanationResult();
    ms_wstring getServerID();

private:
    std::shared_ptr<std::promise<ms_bool>>          _stopBuildSignal;
    ms_bool                                         _isInitSuccess = false;
    ms_int                                          _event;
    ScanResultStatus                                _actionResult;
    ms_shared_layer_ptr                             _layers;
    std::time_t                                     _start_time;
    std::unordered_set<ms_wstring>                  _files;
    MSDict                                          _scanOption{MSDictType::NUL};
    MSDict                                          _scanConfig;
    MSDict                                          _reqHeader;
    std::vector<owc::finder::PathFinder*>           _finders;

    MSDict                                          _scanResult;
    MSDict                                          _additionalData;
};

enum HashCheckType{
  CheckHashAndUpload = 0,
  UploadOnly = 1,
  CheckHashOnly = 2
};

using ms_shared_engine = std::shared_ptr<MalwareScanEngine>;


#endif
